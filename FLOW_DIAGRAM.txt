â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                BEANS&CO MULTI-AGENT WORKFLOW DIAGRAM                          â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚                          ğŸ§‘ USER INPUT                                       â”‚
â”‚                 (Spanish or English natural language)                       â”‚
â”‚                                                                             â”‚
â”‚   Examples:                                                                 â”‚
â”‚   â€¢ "Â¿cuÃ¡ntas pulseras tengo de cada tipo?"                                 â”‚
â”‚   â€¢ "registrame una venta de 20 pulseras negras"                            â”‚
â”‚   â€¢ "gastÃ© 30 dÃ³lares en envÃ­os ayer"                                       â”‚
â”‚   â€¢ "vendÃ­ 2 pulseras black, Â¿cÃ³mo queda el stock?"                         â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                                   â”‚ Initialize AgentState
                                   â”‚ {messages: [], user_input: "..."}
                                   â”‚
                                   â–¼
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                        ğŸ¤– INTENT ROUTER AGENT                                 â•‘
â•‘                        (agents/router.py)                                     â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â”‚                                                                               â”‚
â”‚  Responsibilities:                                                            â”‚
â”‚  âœ“ Analyze user input (bilingual)                                            â”‚
â”‚  âœ“ Classify intent type                                                      â”‚
â”‚  âœ“ Extract entities (product_ref, quantity, amount, date)                    â”‚
â”‚  âœ“ Identify missing fields                                                   â”‚
â”‚                                                                               â”‚
â”‚  Constraints:                                                                 â”‚
â”‚  âœ— NO SQL execution                                                           â”‚
â”‚  âœ— NO database writes                                                         â”‚
â”‚  âœ— NO final decisions                                                         â”‚
â”‚                                                                               â”‚
â”‚  Output:                                                                      â”‚
â”‚  {                                                                            â”‚
â”‚    intent: "READ_ANALYTICS" | "WRITE_OPERATION" | "MIXED" | "AMBIGUOUS"      â”‚
â”‚    operation_type: "REGISTER_SALE" | "REGISTER_EXPENSE" | ...                â”‚
â”‚    confidence: 0.95,                                                          â”‚
â”‚    missing_fields: [],                                                        â”‚
â”‚    normalized_entities: {...}                                                 â”‚
â”‚  }                                                                            â”‚
â”‚                                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â”‚ Route based on intent
              â”‚
              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                  â”‚                   â”‚                 â”‚
              â–¼                  â–¼                   â–¼                 â–¼
     READ_ANALYTICS    WRITE_OPERATION         MIXED          AMBIGUOUS
              â”‚                  â”‚                   â”‚                 â”‚
              â”‚                  â”‚                   â”‚                 â”‚
              â”‚                  â”‚                   â”‚                 â””â”€â”€â”€â”€â”€â”
              â”‚                  â”‚                   â”‚                       â”‚
              â–¼                  â–¼                   â–¼                       â–¼
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  ğŸ“Š READ AGENT      â•‘  â•‘  ğŸ”§ RESOLVER AGENT                  â•‘    â•‘ â“ FINAL      â•‘
â•‘  (read_agent.py)    â•‘  â•‘  (resolver.py)                      â•‘    â•‘   ANSWER      â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•    â•‘               â•‘
â”‚                        â”‚                                           â•‘ "Please       â•‘
â”‚ Responsibilities:      â”‚ Responsibilities:                         â•‘ clarify..."   â•‘
â”‚ âœ“ SQL SELECT only      â”‚ âœ“ Resolve product references              â•‘               â•‘
â”‚ âœ“ Use views            â”‚   "pulseras negras" â†’ product_id: 2       â•‘               â•‘
â”‚ âœ“ Business rules       â”‚ âœ“ Normalize dates                         â•‘               â•‘
â”‚ âœ“ Human explanations   â”‚   "ayer" â†’ "2024-12-24"                   â•‘               â•‘
â”‚                        â”‚ âœ“ Convert amounts                          â•‘               â•‘
â”‚ Constraints:           â”‚   "$30" â†’ 3000 (cents)                    â•‘               â•‘
â”‚ âœ— NO writes            â”‚ âœ“ Validate required fields                â•‘               â•‘
â”‚ âœ— NO business actions  â”‚                                           â•‘               â•‘
â”‚                        â”‚ Constraints:                               â•‘               â•‘
â”‚ Queries:               â”‚ âœ— NO writes                                â•‘               â•‘
â”‚ â€¢ stock_current        â”‚ âœ— NO final decisions                      â•‘               â•‘
â”‚ â€¢ profit_summary       â”‚                                           â•‘               â•‘
â”‚ â€¢ revenue_paid         â”‚ Output:                                    â•‘               â•‘
â”‚                        â”‚ {                                          â•‘               â•‘
â”‚                        â”‚   normalized_entities: {                   â•‘               â•‘
â”‚                        â”‚     items: [                               â•‘               â•‘
â”‚                        â”‚       {product_id: 2, quantity: 20, ...}   â•‘               â•‘
â”‚                        â”‚     ]                                      â•‘               â•‘
â”‚                        â”‚   },                                       â•‘               â•‘
â”‚                        â”‚   missing_fields: []                       â•‘               â•‘
â”‚                        â”‚ }                                          â•‘               â•‘
â”‚                        â”‚                                           â•‘               â•‘
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         â”‚                               â”‚
         â”‚                               â”‚ if no missing fields
         â”‚                               â”‚
         â”‚                               â–¼
         â”‚               â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
         â”‚               â•‘  âœï¸  WRITE AGENT                          â•‘
         â”‚               â•‘  (write_agent.py)                         â•‘
         â”‚               â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         â”‚               â”‚
         â”‚               â”‚ Responsibilities:
         â”‚               â”‚ âœ“ Execute business operations
         â”‚               â”‚   - register_sale(data)
         â”‚               â”‚   - register_expense(data)
         â”‚               â”‚   - register_product(data)
         â”‚               â”‚   - add_stock(data)
         â”‚               â”‚ âœ“ Validate data before execution
         â”‚               â”‚ âœ“ Summarize business impact
         â”‚               â”‚
         â”‚               â”‚ Constraints:
         â”‚               â”‚ âœ— NO raw SQL generation
         â”‚               â”‚ âœ— NO sql_db_query tool
         â”‚               â”‚
         â”‚               â”‚ Output:
         â”‚               â”‚ {
         â”‚               â”‚   operation_result: {
         â”‚               â”‚     sale_id: 123,
         â”‚               â”‚     total_usd: 40.00,
         â”‚               â”‚     revenue_usd: 1500.00,
         â”‚               â”‚     profit_usd: 850.00
         â”‚               â”‚   }
         â”‚               â”‚ }
         â”‚               â”‚
         â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                         â”‚                         â”‚
         â”‚                         â”‚                         â”‚
         â”‚                    if MIXED                  if WRITE_OPERATION
         â”‚                    intent                         â”‚
         â”‚                         â”‚                         â”‚
         â”‚                         â–¼                         â”‚
         â”‚               â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—             â”‚
         â”‚               â•‘  ğŸ“Š READ AGENT      â•‘             â”‚
         â”‚               â•‘  (re-check after    â•‘             â”‚
         â”‚               â•‘   operation)        â•‘             â”‚
         â”‚               â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•             â”‚
         â”‚                         â”‚                         â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                                   â”‚ All paths converge
                                   â”‚
                                   â–¼
                    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
                    â•‘  ğŸ“ FINAL ANSWER NODE         â•‘
                    â•‘  (Format response)            â•‘
                    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                    â”‚
                    â”‚ Format based on results:
                    â”‚ â€¢ sql_result â†’ analytical answer
                    â”‚ â€¢ operation_result â†’ operation summary
                    â”‚ â€¢ both â†’ combined response
                    â”‚ â€¢ error â†’ error message
                    â”‚ â€¢ missing_fields â†’ clarification
                    â”‚
                    â–¼
            â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
            â•‘  ğŸ END               â•‘
            â•‘  Return final_answer  â•‘
            â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                    â”‚
                    â”‚
                    â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  ğŸ‘¤ USER RESPONSE â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


EXAMPLE FLOWS:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1ï¸âƒ£  ANALYTICAL QUERY (READ_ANALYTICS)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Input: "Â¿cuÃ¡ntas pulseras tengo de cada tipo?"

Flow:
  User â†’ Router (classify: READ_ANALYTICS)
       â†’ Read Agent (SQL: SELECT ... FROM stock_current)
       â†’ Final Answer

Output:
  "You have:
   â€¢ BC-BRACELET-BLACK: 37 units
   â€¢ BC-BRACELET-CLASSIC: 45 units
   â€¢ BC-BRACELET-GOLD: 24 units"


2ï¸âƒ£  WRITE OPERATION (WRITE_OPERATION)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Input: "registrame una venta de 20 pulseras negras"

Flow:
  User â†’ Router (classify: WRITE_OPERATION / REGISTER_SALE)
       â†’ Resolver (resolve "pulseras negras" â†’ product_id: 2)
       â†’ Write Agent (execute: register_sale(...))
       â†’ Final Answer

Output:
  "âœ“ Sale registered (ID: 6, Total: $28.00)
     Current revenue: $1100.00
     Current profit: $850.00"


3ï¸âƒ£  MIXED OPERATION (WRITE + READ)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Input: "vendÃ­ 2 pulseras black, Â¿cÃ³mo queda el stock?"

Flow:
  User â†’ Router (classify: MIXED)
       â†’ Resolver (resolve "pulseras black" â†’ product_id: 2)
       â†’ Write Agent (execute: register_sale(...))
       â†’ Read Agent (SQL: SELECT stock_qty ... WHERE product_id = 2)
       â†’ Final Answer

Output:
  "âœ“ Sale registered (ID: 7, Total: $4.00)
     Current revenue: $1104.00

   Current stock for BC-BRACELET-BLACK: 35 units"


4ï¸âƒ£  AMBIGUOUS REQUEST
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Input: "registrar algo"

Flow:
  User â†’ Router (classify: AMBIGUOUS, missing_fields: [...])
       â†’ Final Answer

Output:
  "I need more information. Missing: operation type, details
   For example:
   â€¢ 'Register a sale of 5 black bracelets' (operation)
   â€¢ 'Show me current stock' (analytics)"


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


STATE FLOW:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

AgentState (TypedDict) flows through all nodes:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AgentState                                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ messages: List[Dict]           # Message history            â”‚
â”‚ user_input: str                # Original input             â”‚
â”‚ intent: IntentType             # Classification             â”‚
â”‚ operation_type: OperationType  # Specific operation         â”‚
â”‚ confidence: float              # 0-1 confidence             â”‚
â”‚ missing_fields: List[str]      # Missing data               â”‚
â”‚ normalized_entities: Dict      # Resolved entities          â”‚
â”‚ sql_result: str                # Read agent result          â”‚
â”‚ operation_result: Dict         # Write agent result         â”‚
â”‚ final_answer: str              # Final response             â”‚
â”‚ error: str                     # Error if any               â”‚
â”‚ next_action: str               # Flow control               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Each agent reads this state and returns updates.
LangGraph merges updates as the state flows through nodes.


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
